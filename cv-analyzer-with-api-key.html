<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Academic CV Analyzer | The Professor Is In</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;600;700&family=Work+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #1e3a5f;
            --secondary: #2c5f8d;
            --accent: #d4af37;
            --success: #2d6a4f;
            --warning: #f77f00;
            --error: #c1121f;
            --bg: #fafafa;
            --surface: #ffffff;
            --text: #1a1a1a;
            --text-muted: #666;
            --border: #e0e0e0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Work Sans', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        header {
            text-align: center;
            margin-bottom: 3rem;
            animation: fadeInDown 0.8s ease-out;
        }

        h1 {
            font-family: 'Crimson Pro', serif;
            font-size: 3.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
            letter-spacing: -0.02em;
        }

        .subtitle {
            font-size: 1.1rem;
            color: var(--text-muted);
            font-weight: 400;
        }

        .tagline {
            font-style: italic;
            color: var(--secondary);
            margin-top: 0.5rem;
            font-family: 'Crimson Pro', serif;
        }

        .api-key-section {
            background: var(--surface);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            animation: fadeInUp 0.8s ease-out;
        }

        .api-key-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .api-key-icon {
            font-size: 2rem;
        }

        .api-key-title {
            font-family: 'Crimson Pro', serif;
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary);
        }

        .api-key-input-group {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .input-field {
            flex: 1;
            padding: 0.875rem 1.25rem;
            border: 2px solid var(--border);
            border-radius: 6px;
            font-size: 1rem;
            font-family: 'Work Sans', sans-serif;
            transition: all 0.3s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(44, 95, 141, 0.1);
        }

        .input-field.has-key {
            border-color: var(--success);
            background: rgba(45, 106, 79, 0.05);
        }

        .api-help {
            background: rgba(30, 58, 95, 0.05);
            padding: 1rem;
            border-radius: 6px;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .api-help a {
            color: var(--secondary);
            font-weight: 600;
            text-decoration: none;
        }

        .api-help a:hover {
            text-decoration: underline;
        }

        .api-status {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .api-status.connected {
            background: rgba(45, 106, 79, 0.1);
            color: var(--success);
        }

        .api-status.disconnected {
            background: rgba(193, 18, 31, 0.1);
            color: var(--error);
        }

        .upload-section {
            background: var(--surface);
            border-radius: 12px;
            padding: 3rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            margin-bottom: 2rem;
            transition: all 0.3s ease;
            animation: fadeInUp 0.8s ease-out 0.2s both;
        }

        .upload-section.disabled {
            opacity: 0.6;
            pointer-events: none;
        }

        .upload-zone {
            border: 3px dashed var(--border);
            border-radius: 8px;
            padding: 4rem 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, rgba(30, 58, 95, 0.02) 0%, rgba(44, 95, 141, 0.02) 100%);
        }

        .upload-zone:hover {
            border-color: var(--secondary);
            background: linear-gradient(135deg, rgba(30, 58, 95, 0.05) 0%, rgba(44, 95, 141, 0.05) 100%);
            transform: translateY(-2px);
        }

        .upload-zone.dragging {
            border-color: var(--accent);
            background: rgba(212, 175, 55, 0.1);
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.6;
        }

        .upload-text {
            font-size: 1.2rem;
            color: var(--text);
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .upload-subtext {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .file-input {
            display: none;
        }

        .btn {
            padding: 0.875rem 2rem;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Work Sans', sans-serif;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(30, 58, 95, 0.3);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(30, 58, 95, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: white;
            color: var(--secondary);
            border: 2px solid var(--secondary);
        }

        .btn-secondary:hover {
            background: var(--secondary);
            color: white;
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
        }

        .analyzing {
            text-align: center;
            padding: 3rem;
            animation: fadeIn 0.5s ease-out;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid var(--border);
            border-top: 4px solid var(--secondary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1.5rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results-container {
            animation: fadeInUp 0.8s ease-out;
        }

        .results-header {
            background: var(--surface);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .score-card {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .score-item {
            background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.7) 100%);
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
            border: 2px solid var(--border);
            transition: all 0.3s ease;
        }

        .score-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }

        .score-number {
            font-size: 2.5rem;
            font-weight: 700;
            font-family: 'Crimson Pro', serif;
            margin-bottom: 0.5rem;
        }

        .score-label {
            font-size: 0.9rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 500;
        }

        .score-item.passed .score-number { color: var(--success); }
        .score-item.warnings .score-number { color: var(--warning); }
        .score-item.failed .score-number { color: var(--error); }

        .category-section {
            background: var(--surface);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            animation: fadeInUp 0.8s ease-out;
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border);
        }

        .category-title {
            font-family: 'Crimson Pro', serif;
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--primary);
        }

        .category-score {
            font-size: 1.2rem;
            font-weight: 600;
            padding: 0.5rem 1rem;
            border-radius: 20px;
        }

        .category-score.excellent {
            background: rgba(45, 106, 79, 0.1);
            color: var(--success);
        }

        .category-score.good {
            background: rgba(247, 127, 0, 0.1);
            color: var(--warning);
        }

        .category-score.needs-work {
            background: rgba(193, 18, 31, 0.1);
            color: var(--error);
        }

        .issue-item {
            padding: 1.25rem;
            margin-bottom: 1rem;
            border-radius: 8px;
            border-left: 4px solid;
            background: rgba(0,0,0,0.02);
            transition: all 0.3s ease;
        }

        .issue-item:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        .issue-item.passed {
            border-left-color: var(--success);
            background: rgba(45, 106, 79, 0.05);
        }

        .issue-item.warning {
            border-left-color: var(--warning);
            background: rgba(247, 127, 0, 0.05);
        }

        .issue-item.error {
            border-left-color: var(--error);
            background: rgba(193, 18, 31, 0.05);
        }

        .issue-header {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            margin-bottom: 0.75rem;
        }

        .issue-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .issue-content {
            flex: 1;
        }

        .issue-title {
            font-weight: 600;
            font-size: 1.05rem;
            margin-bottom: 0.5rem;
            color: var(--text);
        }

        .issue-description {
            color: var(--text-muted);
            line-height: 1.6;
            margin-bottom: 0.75rem;
        }

        .issue-suggestion {
            background: rgba(255,255,255,0.7);
            padding: 0.875rem;
            border-radius: 6px;
            font-size: 0.95rem;
            border: 1px solid var(--border);
        }

        .suggestion-label {
            font-weight: 600;
            color: var(--secondary);
            margin-bottom: 0.5rem;
            display: block;
        }

        .actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .error-message {
            background: rgba(193, 18, 31, 0.1);
            color: var(--error);
            padding: 1.5rem;
            border-radius: 8px;
            margin: 1rem 0;
            border-left: 4px solid var(--error);
            animation: fadeIn 0.5s ease-out;
        }

        .success-message {
            background: rgba(45, 106, 79, 0.1);
            color: var(--success);
            padding: 1rem;
            border-radius: 6px;
            margin: 1rem 0;
            border-left: 4px solid var(--success);
            animation: fadeIn 0.5s ease-out;
        }

        .file-info {
            background: rgba(30, 58, 95, 0.05);
            padding: 1rem;
            border-radius: 6px;
            margin-top: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .file-name {
            font-weight: 600;
            color: var(--primary);
        }

        .file-size {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .privacy-notice {
            background: rgba(212, 175, 55, 0.1);
            border: 2px solid var(--accent);
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 2rem;
        }

        .privacy-title {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .privacy-content {
            font-size: 0.9rem;
            color: var(--text-muted);
            line-height: 1.6;
        }

        footer {
            text-align: center;
            margin-top: 4rem;
            padding: 2rem;
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        footer a {
            color: var(--secondary);
            text-decoration: none;
            font-weight: 500;
        }

        footer a:hover {
            text-decoration: underline;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2.5rem;
            }

            .container {
                padding: 1rem;
            }

            .upload-section {
                padding: 1.5rem;
            }

            .score-card {
                grid-template-columns: 1fr;
            }

            .api-key-input-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Checklist data based on "The Professor Is In"
        const CHECKLIST_CATEGORIES = {
            formatting: {
                title: "I. Formatting Rules",
                checks: [
                    { id: "margins", label: "One-inch margins on all sides", severity: "error" },
                    { id: "font-size", label: "12-point type throughout (except name)", severity: "error" },
                    { id: "spacing", label: "Single-spaced with proper blank lines", severity: "error" },
                    { id: "name-format", label: "Name in 14-16pt, centered at top", severity: "warning" },
                    { id: "headings-caps", label: "Headings in bold and ALL CAPS", severity: "warning" },
                    { id: "subheadings-bold", label: "Subheadings in bold only (not all caps)", severity: "warning" },
                    { id: "no-bullets", label: "NO bullet points anywhere", severity: "error" },
                    { id: "no-boxes", label: "NO box or column formatting", severity: "error" },
                    { id: "year-left", label: "Year-to-the-left rule followed", severity: "error" },
                    { id: "left-justified", label: "All elements left justified", severity: "warning" }
                ]
            },
            content: {
                title: "II. Content Structure",
                checks: [
                    { id: "education-first", label: "Education section is first", severity: "error" },
                    { id: "degree-format", label: "Listed by degree, not institution", severity: "warning" },
                    { id: "no-spelling-out", label: "Degrees not spelled out (Ph.D., not 'Doctor of Philosophy')", severity: "warning" },
                    { id: "publications-peer", label: "Publications section emphasizes peer-reviewed work", severity: "error" },
                    { id: "section-order", label: "Proper section order (Publications before Teaching)", severity: "error" },
                    { id: "no-duties", label: "NO descriptions of 'duties' under Teaching", severity: "error" },
                    { id: "no-narratives", label: "NO narrative paragraphs describing work", severity: "error" }
                ]
            },
            language: {
                title: "III. Language & Tone",
                checks: [
                    { id: "no-personal", label: "NO personal stories or ruminations", severity: "error" },
                    { id: "no-explanations", label: "NO explanations of grants/fellowships", severity: "warning" },
                    { id: "specific-dates", label: "Years visible and scannable", severity: "warning" },
                    { id: "no-dr-title", label: "References not listed as 'Dr. X' or 'Professor X'", severity: "warning" }
                ]
            },
            organization: {
                title: "IV. Organization Principle",
                checks: [
                    { id: "peer-review", label: "Peer-reviewed items prioritized", severity: "error" },
                    { id: "competitive-first", label: "Competitive achievements listed before non-competitive", severity: "warning" },
                    { id: "reverse-chrono", label: "Reverse chronological order within sections", severity: "warning" }
                ]
            }
        };

        function CVAnalyzer() {
            const [apiKey, setApiKey] = useState('');
            const [file, setFile] = useState(null);
            const [analyzing, setAnalyzing] = useState(false);
            const [results, setResults] = useState(null);
            const [error, setError] = useState(null);
            const [dragging, setDragging] = useState(false);
            const [apiKeyStored, setApiKeyStored] = useState(false);
            const fileInputRef = useRef(null);

            useEffect(() => {
                // Load API key from localStorage on mount
                const stored = localStorage.getItem('anthropic_api_key');
                if (stored) {
                    setApiKey(stored);
                    setApiKeyStored(true);
                }
            }, []);

            const handleApiKeySubmit = () => {
                if (apiKey.trim()) {
                    localStorage.setItem('anthropic_api_key', apiKey.trim());
                    setApiKeyStored(true);
                    setError(null);
                }
            };

            const handleApiKeyClear = () => {
                localStorage.removeItem('anthropic_api_key');
                setApiKey('');
                setApiKeyStored(false);
            };

            const handleFileSelect = (selectedFile) => {
                if (selectedFile && selectedFile.type === 'application/pdf') {
                    setFile(selectedFile);
                    setError(null);
                } else {
                    setError('Please upload a PDF file.');
                }
            };

            const handleDragOver = (e) => {
                e.preventDefault();
                setDragging(true);
            };

            const handleDragLeave = () => {
                setDragging(false);
            };

            const handleDrop = (e) => {
                e.preventDefault();
                setDragging(false);
                const droppedFile = e.dataTransfer.files[0];
                handleFileSelect(droppedFile);
            };

            const extractTextFromPDF = async (file) => {
                try {
                    const arrayBuffer = await file.arrayBuffer();
                    const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                    let fullText = '';

                    for (let i = 1; i <= pdf.numPages; i++) {
                        const page = await pdf.getPage(i);
                        const textContent = await page.getTextContent();
                        const pageText = textContent.items.map(item => item.str).join(' ');
                        fullText += pageText + '\n';
                    }

                    return fullText;
                } catch (err) {
                    throw new Error('Failed to extract text from PDF: ' + err.message);
                }
            };

            const analyzeCV = async () => {
                if (!file || !apiKey) return;

                setAnalyzing(true);
                setError(null);

                try {
                    // Extract text from PDF
                    const cvText = await extractTextFromPDF(file);

                    // Call Anthropic API with proper headers
                    const response = await fetch('https://api.anthropic.com/v1/messages', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'x-api-key': apiKey,
                            'anthropic-version': '2023-06-01'
                        },
                        body: JSON.stringify({
                            model: 'claude-sonnet-4-20250514',
                            max_tokens: 4000,
                            messages: [{
                                role: 'user',
                                content: `You are an expert academic CV reviewer based on "The Professor Is In" guidelines by Dr. Karen Kelsky.

Analyze this CV text and provide a detailed assessment against the following checklist categories. For each check item, determine if it PASSES, has a WARNING, or FAILS.

CHECKLIST CATEGORIES:
${JSON.stringify(CHECKLIST_CATEGORIES, null, 2)}

CV TEXT TO ANALYZE:
${cvText.substring(0, 15000)}

Respond ONLY with a valid JSON object in this exact format (no markdown, no extra text):
{
  "overall_score": 85,
  "categories": {
    "formatting": {
      "score": 90,
      "rating": "excellent",
      "issues": [
        {
          "id": "margins",
          "status": "passed",
          "title": "Margins Check",
          "description": "One-inch margins are properly maintained throughout the CV",
          "suggestion": ""
        },
        {
          "id": "no-bullets",
          "status": "failed",
          "title": "Bullet Points Detected",
          "description": "Found bullet points in the Teaching section",
          "suggestion": "Remove all bullet points. Use paragraph format with year-to-the-left instead. Remember: this is a CV, not a resume."
        }
      ]
    },
    "content": {
      "score": 75,
      "rating": "good",
      "issues": []
    },
    "language": {
      "score": 80,
      "rating": "good",
      "issues": []
    },
    "organization": {
      "score": 85,
      "rating": "excellent",
      "issues": []
    }
  }
}

Status options: "passed", "warning", "failed"
Rating options: "excellent" (90-100), "good" (70-89), "needs-work" (<70)

For each checklist item, provide:
- Specific assessment of whether it passes or fails
- Clear description of what was found
- Actionable suggestion if it fails or has warnings

Be thorough and specific in your analysis.`
                            }]
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({}));
                        throw new Error(`API Error ${response.status}: ${errorData.error?.message || 'Request failed'}`);
                    }

                    const data = await response.json();
                    const analysisText = data.content[0].text;
                    
                    // Extract JSON from response (handle markdown code blocks)
                    let jsonText = analysisText.trim();
                    jsonText = jsonText.replace(/```json\n?/g, '').replace(/```\n?/g, '');
                    const jsonMatch = jsonText.match(/\{[\s\S]*\}/);
                    
                    if (!jsonMatch) {
                        throw new Error('Failed to parse analysis results. Response format unexpected.');
                    }

                    const analysisResults = JSON.parse(jsonMatch[0]);
                    setResults(analysisResults);

                } catch (err) {
                    console.error('Analysis error:', err);
                    setError(err.message || 'Analysis failed. Please check your API key and try again.');
                } finally {
                    setAnalyzing(false);
                }
            };

            const resetAnalyzer = () => {
                setFile(null);
                setResults(null);
                setError(null);
            };

            const downloadReport = () => {
                if (!results) return;

                const reportText = `Academic CV Analysis Report
Generated: ${new Date().toLocaleDateString()}
Based on "The Professor Is In" by Dr. Karen Kelsky

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

OVERALL SCORE: ${results.overall_score}/100

${Object.entries(results.categories).map(([key, category]) => `
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

${category.title || key.toUpperCase()}
Category Score: ${category.score}/100
Rating: ${category.rating.toUpperCase()}

${category.issues.length > 0 ? 'Issues Found:' : 'No issues found - excellent!'}

${category.issues.map((issue, idx) => `
${idx + 1}. ${issue.title}
   Status: ${issue.status.toUpperCase()}
   ${issue.description}
   ${issue.suggestion ? `
   üí° Suggestion: ${issue.suggestion}` : ''}
`).join('\n')}
`).join('\n')}

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

This analysis is based on the guidelines from "The Professor Is In" 
by Dr. Karen Kelsky. For more information, visit:
https://theprofessorisin.com/

Generated by Academic CV Analyzer
`;

                const blob = new Blob([reportText], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `CV_Analysis_Report_${new Date().toISOString().split('T')[0]}.txt`;
                a.click();
                URL.revokeObjectURL(url);
            };

            const calculateStats = () => {
                if (!results) return { passed: 0, warnings: 0, failed: 0 };

                let passed = 0, warnings = 0, failed = 0;

                Object.values(results.categories).forEach(category => {
                    category.issues.forEach(issue => {
                        if (issue.status === 'passed') passed++;
                        else if (issue.status === 'warning') warnings++;
                        else failed++;
                    });
                });

                return { passed, warnings, failed };
            };

            const stats = results ? calculateStats() : { passed: 0, warnings: 0, failed: 0 };

            return (
                <div className="container">
                    <header>
                        <h1>Academic CV Analyzer</h1>
                        <p className="subtitle">Powered by "The Professor Is In" Guidelines</p>
                        <p className="tagline">Transform your CV from graduate student to faculty colleague</p>
                    </header>

                    {/* API Key Section */}
                    <div className="api-key-section">
                        <div className="api-key-header">
                            <span className="api-key-icon">üîë</span>
                            <h2 className="api-key-title">Anthropic API Key</h2>
                            {apiKeyStored && (
                                <span className="api-status connected">
                                    ‚úì Connected
                                </span>
                            )}
                        </div>

                        {!apiKeyStored ? (
                            <>
                                <div className="api-key-input-group">
                                    <input
                                        type="password"
                                        className="input-field"
                                        placeholder="Enter your Anthropic API Key (sk-ant-...)"
                                        value={apiKey}
                                        onChange={(e) => setApiKey(e.target.value)}
                                        onKeyPress={(e) => e.key === 'Enter' && handleApiKeySubmit()}
                                    />
                                    <button
                                        className="btn btn-primary"
                                        onClick={handleApiKeySubmit}
                                        disabled={!apiKey.trim()}
                                    >
                                        Save Key
                                    </button>
                                </div>
                                <div className="api-help">
                                    <strong>Need an API Key?</strong>
                                    <br />
                                    1. Go to <a href="https://console.anthropic.com/" target="_blank" rel="noopener noreferrer">console.anthropic.com</a>
                                    <br />
                                    2. Sign up or log in
                                    <br />
                                    3. Navigate to "API Keys" section
                                    <br />
                                    4. Click "Create Key" and copy it here
                                    <br />
                                    <br />
                                    <strong>Privacy:</strong> Your API key is stored locally in your browser only. It is never sent to any server except Anthropic's API.
                                </div>
                            </>
                        ) : (
                            <div className="success-message">
                                <strong>‚úì API Key configured successfully!</strong> You can now upload and analyze your CV.
                                <button
                                    className="btn btn-secondary btn-small"
                                    onClick={handleApiKeyClear}
                                    style={{marginLeft: '1rem'}}
                                >
                                    Clear Key
                                </button>
                            </div>
                        )}
                    </div>

                    {/* Upload Section */}
                    {!results && !analyzing && (
                        <div className={`upload-section ${!apiKeyStored ? 'disabled' : ''}`}>
                            {!apiKeyStored && (
                                <div className="error-message" style={{marginBottom: '1.5rem'}}>
                                    <strong>‚ö† Please enter your API Key above to enable CV analysis</strong>
                                </div>
                            )}
                            
                            <div
                                className={`upload-zone ${dragging ? 'dragging' : ''}`}
                                onClick={() => apiKeyStored && fileInputRef.current?.click()}
                                onDragOver={handleDragOver}
                                onDragLeave={handleDragLeave}
                                onDrop={handleDrop}
                            >
                                <div className="upload-icon">üìÑ</div>
                                <div className="upload-text">
                                    {file ? 'File Selected' : 'Drop your CV here or click to browse'}
                                </div>
                                <div className="upload-subtext">
                                    PDF format only ‚Ä¢ Max 10MB
                                </div>
                            </div>

                            <input
                                ref={fileInputRef}
                                type="file"
                                accept=".pdf"
                                onChange={(e) => handleFileSelect(e.target.files[0])}
                                className="file-input"
                            />

                            {file && (
                                <div className="file-info">
                                    <div>
                                        <div className="file-name">{file.name}</div>
                                        <div className="file-size">
                                            {(file.size / 1024 / 1024).toFixed(2)} MB
                                        </div>
                                    </div>
                                    <button
                                        className="btn btn-primary"
                                        onClick={analyzeCV}
                                        disabled={!apiKeyStored}
                                    >
                                        Analyze CV
                                    </button>
                                </div>
                            )}

                            {error && (
                                <div className="error-message">
                                    <strong>Error:</strong> {error}
                                </div>
                            )}

                            <div className="privacy-notice">
                                <div className="privacy-title">
                                    üîí Privacy & Data Security
                                </div>
                                <div className="privacy-content">
                                    ‚Ä¢ Your CV text is sent to Anthropic's Claude API for analysis only
                                    <br />
                                    ‚Ä¢ According to Anthropic's privacy policy, API requests are not used for model training
                                    <br />
                                    ‚Ä¢ No data is stored on our servers (this tool runs entirely in your browser)
                                    <br />
                                    ‚Ä¢ Your API key is stored locally in your browser only
                                    <br />
                                    ‚Ä¢ Consider removing sensitive personal information before analysis
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Analyzing State */}
                    {analyzing && (
                        <div className="analyzing">
                            <div className="spinner"></div>
                            <h2>Analyzing Your CV...</h2>
                            <p>This may take 30-60 seconds</p>
                            <p style={{fontSize: '0.9rem', color: 'var(--text-muted)', marginTop: '1rem'}}>
                                Claude is carefully reviewing your CV against "The Professor Is In" checklist
                            </p>
                        </div>
                    )}

                    {/* Results Section */}
                    {results && (
                        <div className="results-container">
                            <div className="results-header">
                                <h2>Analysis Complete</h2>
                                <div className="score-card">
                                    <div className="score-item">
                                        <div className="score-number" style={{color: 'var(--primary)'}}>
                                            {results.overall_score}
                                        </div>
                                        <div className="score-label">Overall Score</div>
                                    </div>
                                    <div className="score-item passed">
                                        <div className="score-number">{stats.passed}</div>
                                        <div className="score-label">Passed</div>
                                    </div>
                                    <div className="score-item warnings">
                                        <div className="score-number">{stats.warnings}</div>
                                        <div className="score-label">Warnings</div>
                                    </div>
                                    <div className="score-item failed">
                                        <div className="score-number">{stats.failed}</div>
                                        <div className="score-label">Needs Fix</div>
                                    </div>
                                </div>
                            </div>

                            {Object.entries(results.categories).map(([key, category]) => (
                                <div key={key} className="category-section">
                                    <div className="category-header">
                                        <h3 className="category-title">{category.title || key}</h3>
                                        <span className={`category-score ${category.rating}`}>
                                            {category.score}/100
                                        </span>
                                    </div>

                                    {category.issues.length === 0 ? (
                                        <div className="issue-item passed">
                                            <div className="issue-header">
                                                <span className="issue-icon">‚úÖ</span>
                                                <div className="issue-content">
                                                    <div className="issue-title">All checks passed!</div>
                                                    <div className="issue-description">
                                                        This section meets all "The Professor Is In" guidelines.
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    ) : (
                                        category.issues.map((issue, idx) => (
                                            <div key={idx} className={`issue-item ${issue.status}`}>
                                                <div className="issue-header">
                                                    <span className="issue-icon">
                                                        {issue.status === 'passed' ? '‚úÖ' :
                                                         issue.status === 'warning' ? '‚ö†Ô∏è' : '‚ùå'}
                                                    </span>
                                                    <div className="issue-content">
                                                        <div className="issue-title">{issue.title}</div>
                                                        <div className="issue-description">{issue.description}</div>
                                                        {issue.suggestion && (
                                                            <div className="issue-suggestion">
                                                                <span className="suggestion-label">üí° Suggestion:</span>
                                                                {issue.suggestion}
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                            </div>
                                        ))
                                    )}
                                </div>
                            ))}

                            <div className="actions">
                                <button className="btn btn-secondary" onClick={resetAnalyzer}>
                                    Analyze Another CV
                                </button>
                                <button className="btn btn-primary" onClick={downloadReport}>
                                    üì• Download Report
                                </button>
                            </div>
                        </div>
                    )}

                    <footer>
                        <p>
                            Based on <a href="https://theprofessorisin.com/" target="_blank" rel="noopener noreferrer">The Professor Is In</a> by Dr. Karen Kelsky
                        </p>
                        <p style={{marginTop: '0.5rem', fontSize: '0.85rem'}}>
                            Built for Academic Job Market Workshop ‚Ä¢ 2025
                        </p>
                    </footer>
                </div>
            );
        }

        // Initialize PDF.js worker
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        // Render app
        ReactDOM.render(<CVAnalyzer />, document.getElementById('root'));
    </script>
</body>
</html>
